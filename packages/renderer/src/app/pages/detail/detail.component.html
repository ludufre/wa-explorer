<ion-content class="detail-content">
  <div class="messages-container">
    <div class="detail-header">
      <h1 class="contact-name">{{ contactName || contactJid }}</h1>
    </div>

    @if (loading) {
      <div class="loading-container">
        <ion-spinner></ion-spinner>
        <p>{{ 'PAGES.DETAIL.LOADING' | translate }}</p>
      </div>
    }

    @if (error) {
      <div class="error-container">
        <p>{{ error | translate }}</p>
        <a routerLink="/pickup">{{ 'PAGES.DETAIL.BACK_TO_HOME' | translate }}</a>
      </div>
    }

    @if (!loading && !error && messages.length === 0) {
      <div class="empty-container">
        <p>{{ 'PAGES.DETAIL.NO_MESSAGES' | translate }}</p>
      </div>
    }

    @if (!loading && !error && messages.length > 0) {
      <div class="messages-list">
        @for (group of messageGroups; track group.dateObj) {
          <div class="date-separator">
            <span>{{ group.date }}</span>
          </div>
          @for (message of group.messages; track message.id) {
            <div class="message" [class.from-me]="message.isFromMe" [class.from-them]="!message.isFromMe">
              <div class="message-bubble">
                @if (!message.isFromMe && message.groupMember) {
                  <div class="message-sender">{{ message.groupMember }}</div>
                }
                @if (message.mediaItemId) {
                  <div class="message-media">
                    @if (getMediaPath(message.mediaItemId); as mediaPath) {
                      <img [src]="mediaPath" alt="Media" />
                    } @else {
                      <div class="media-placeholder">
                        <ion-spinner name="crescent"></ion-spinner>
                      </div>
                    }
                  </div>
                }
                @if (message.text) {
                  <div class="message-text">{{ message.text }}</div>
                }
                <div class="message-time">{{ formatTime(message.date) }}</div>
              </div>
            </div>
          }
        }
      </div>
    }
  </div>
</ion-content>
